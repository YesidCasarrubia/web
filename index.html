<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consumo de Energía</title>
    <!-- Agrega el enlace a Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://rawgit.com/eKoopmans/html2pdf/master/dist/html2pdf.bundle.js"></script>

    <link rel="stylesheet" href="style.css">
    <style>
               body {
        height: 500px;
        background-image: url("https://c.wallhere.com/photos/c0/7d/2005_cows_cairns_hdr_alandot_alandotcomgmailcom-846805.jpg!d");
        background-repeat: no-repeat;
        background-position: center;
        background-size: 100rem;
        font-family: Arial, sans-serif;
        text-align: center;
    }

    canvas {
        max-width: 600px;
        margin: 20px auto;
        background-color: #ffffff;
        border-radius: 10px;
    }

    table {
        border-collapse: collapse;
        width: 30%; /* Reduce the width of the table */
        margin: 10px auto; /* Adjust the margin for better spacing */
        background-color: #f9f9f9;
        border-radius: 10px;
    }

    table, th, td {
        border: 1px solid #ddd;
    }

    th, td {
        padding: 8px; /* Reduce padding for a more compact look */
        text-align: center;
    }

    th {
        background-color: #f2f2f2;
    }

    button {
        background-color: #4CAF50; /* Green background color */
        color: white; /* White text color */
        padding: 10px 20px; /* Padding for better appearance */
        border: none; /* Remove border */
        border-radius: 5px; /* Add border radius for rounded corners */
        cursor: pointer; /* Add a pointer cursor on hover */
        font-size: 16px; /* Adjust font size */
        margin-top: 10px; /* Add some top margin for spacing */
    }

    button:hover {
        background-color: #45a049; /* Darker green on hover */
    }

    h2 {
        background-color: #87CEEB; /* Light blue background color */
        padding: 10px; /* Padding for better appearance */
        color: #fff; /* White text color */
        border-radius: 5px; /* Add border radius for rounded corners */
    }





    </style>
</head>
<body>
    <h2>Consumo Semanal de Energía</h2>

    <!-- Gráfica de Consumo -->
    <canvas id="consumoChart"></canvas>

    <!-- Tabla de Consumo Semanal -->
    <table>
        <thead>
            <tr>
                <th>Día</th>
                <th>Consumo (kW)</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>Lunes</td>
                <td id="lunesConsumo">2.238</td>
            </tr>
            <tr>
                <td>Martes</td>
                <td id="martesConsumo">13.428</td>
            </tr>
            <tr>
                <td>Miércoles</td>
                <td id="miercolesConsumo">4.476</td>
            </tr>
            <tr>
                <td>Jueves</td>
                <td id="juevesConsumo">0</td>
            </tr>
            <tr>
                <td>Viernes</td>
                <td id="viernesConsumo">1.119</td>
            </tr>
            <tr>
                <td>Sábado</td>
                <td id="sabadoConsumo">3.357</td>
            </tr>
            <tr>
                <td>Domingo</td>
                <td id="domingoConsumo">0</td>
            </tr>
        </tbody>
        <tfoot>
            <tr>
                <th>Total Semanal</th>
                <th id="totalConsumo"></th>
            </tr>
        </tfoot>
    </table>

    <!-- Tabla de Consumo Mensual -->
    <table id="consumoMensual" style="display: none;">
        <thead>
            <tr>
                <th>Mes</th>
                <th>Consumo (kW)</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>Diciembre</td>
                <td id="diciembreConsumo">0</td>
            </tr>
            
        </tbody>
        <tfoot>
            <tr>
                <th>Total Mensual</th>
                <th id="totalMensual"></th>
            </tr>
        </tfoot>
    </table>

    <!-- Botón para mostrar consumo por mes -->
    <button onclick="mostrarConsumoMensual()">Consumo por Mes</button>
    <button onclick="printScreenToPDF()">Imprimir como PDF</button>

    <script>
        const consumoData = [2.238, 13.428, 4.476, 0, 1.119, 0, 0];
        const mesesData = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]; // Inicializa los consumos mensuales en 0
        const ctx = document.getElementById('consumoChart').getContext('2d');
        const consumoChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado', 'Domingo'],
                datasets: [{
                    label: 'Consumo (kW)',
                    data: consumoData,
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    borderColor: 'rgba(75, 192, 192, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });

        function mostrarConsumoMensual() {
            // Hide the weekly table and chart
            document.getElementById('consumoChart').style.display = 'none';
            document.getElementById('totalConsumo').parentNode.parentNode.style.display = 'none';

            // Show the monthly table for December
            document.getElementById('consumoMensual').style.display = 'table';

            // Hide the button after clicking it (optional, adjust as needed)
            document.querySelector('button').style.display = 'none';
        }



        function actualizarSabado() {
            // Get the current consumption value for Saturday
            const sabadoValue = parseFloat(document.getElementById('sabadoConsumo').textContent);

            // Increment the Saturday consumption value (you can adjust the increment as needed)
            document.getElementById('sabadoConsumo').textContent = (sabadoValue + 0.0006216).toFixed(3);

            // Update the value in the consumptionData array and the chart
            consumoData[5] = sabadoValue + 0.0006216;
            consumoChart.update();

            // Recalculate the total weekly consumption
            const totalSemana = consumoData.reduce((total, consumo) => total + consumo, 0);
            document.getElementById('totalConsumo').textContent = totalSemana.toFixed(3);

            // Recalculate the total monthly consumption (assuming 4 weeks in a month)
            const totalMensual = totalSemana * 4;
            // Update the value for December (you may need to adjust this based on your actual month)
            mesesData[11] = totalMensual;
            document.getElementById('diciembreConsumo').textContent = totalMensual.toFixed(3);
            document.getElementById('totalMensual').textContent = totalMensual.toFixed(3);
        }

        // Set the interval to call actualizarSabado every 5 seconds
        setInterval(actualizarSabado, 5000);

       
        function printScreenToPDF() {
        // Define the options for html2pdf
        const options = {
            margin: 10,
            filename: 'consumo_energia.pdf',
            image: { type: 'jpeg', quality: 0.98 },
            html2canvas: { scale: 2 },
            jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' },
        };

        // Get the body element
        const body = document.body;

        // Use html2pdf to generate a PDF from the body content
        html2pdf(body, options);

        // Show the button for printing monthly consumption after generating the PDF
        document.getElementById('printMonthlyButton').style.display = 'block';
    }


    function printMonthlyToPDF() {
        // Define the options for html2pdf
        const options = {
            margin: 10,
            filename: 'consumo_mensual.pdf',
            image: { type: 'jpeg', quality: 1 },
            html2canvas: { scale: 2 }, // You can experiment with the scale factor
            jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' },
        };

        // Get the monthly consumption table
        const monthlyTable = document.getElementById('consumoMensual');

        // Create a div element to hold the content to be added to the PDF
        const contentDiv = document.createElement('div');
        contentDiv.appendChild(document.createTextNode('Mes: DICIEMBRE'));
        
        // Clone the monthly table and append it to the content div
        const clonedTable = monthlyTable.cloneNode(true);
        contentDiv.appendChild(clonedTable);

        // Get the total monthly consumption
        const totalMensual = parseFloat(document.getElementById('totalMensual').textContent);
        contentDiv.appendChild(document.createTextNode(`Total Mensual: ${totalMensual.toFixed(3)} kW`));

        // Use html2pdf to generate a PDF from the content div
        html2pdf(contentDiv, options);
    }


    </script>
</body>
</html>
